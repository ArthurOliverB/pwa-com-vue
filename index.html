<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>News</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Imports -->
    <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
    <!-- <script src="app.js"></script> -->
    <!--  -->
</head>
<body>
    <header class= "header">
        <h1>{{title}}</h1>
            <select v-model="selected" @change.prevent="onChange">
                    <option value = "" selected="false" disabled="disabled">Filter by source</option>    
                    <option v-for="source in sources"> {{source.id}} </option>
            </select>
    </header>
    
    <main id= "content">
        <div class= "grid" v-for= 'article in news'>
            <a id= "link" :href="article.url">
                <img id= "thumbnail":src="article.urlToImage"/>
                <p> {{ article.author }}</p>
                <h2> {{ article.title }}</h2>
            </a>
        </div>
    </main>
</body>
<!-- Vue -->
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script>
    window.addEventListener('load', data => {
        content.fetchNews()
        header.fetchSources()
    })

    const header = new Vue({
        el: '.header',
        data: {
            title: "News",
            selected: "",
            sources: []
        }, 
        methods: {
            async fetchSources(){
                const res = await fetch(`https://newsapi.org/v2/sources?apiKey=4c48e10ab72d4baa8feff20c49cac921`)
                const json = await res.json()
                this.sources = json.sources
            },
            async fetchFromSource(source){
                const res = await fetch(`https://newsapi.org/v2/top-headlines?sources=${source}&apiKey=4c48e10ab72d4baa8feff20c49cac921`)
                const json = await res.json()
                content.news = json.articles
                console.log(json)
            }, 
            onChange() {
                this.fetchFromSource(this.selected)
            }
        }
    })
    const content = new Vue({
        el: '#content',
        data: {
            news: [],
        },
        methods: {
            async fetchNews() {
                const res = await fetch(`https://newsapi.org/v2/top-headlines?country=us&category=business&apiKey=4c48e10ab72d4baa8feff20c49cac921`)
                const json = await res.json()
                this.news = json.articles
            }
        }
    })
</script>
</html>